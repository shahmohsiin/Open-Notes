<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visitor Dashboard</title>
<style>
  /* Reset & Base */
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%); min-height:100vh; position:relative; overflow-x:hidden; }

  /* Animated Background Orbs */
  body::before, body::after { content:''; position:fixed; border-radius:50%; filter: blur(80px); opacity:0.5; animation:float 20s infinite ease-in-out; }
  body::before { width:400px;height:400px;background:rgba(240,147,251,0.4);top:-100px;left:-100px;animation-delay:0s;}
  body::after { width:500px;height:500px;background:rgba(102,126,234,0.3);bottom:-150px;right:-150px;animation-delay:10s;}
  @keyframes float{0%,100%{transform:translate(0,0) scale(1);}33%{transform:translate(30px,-30px) scale(1.1);}66%{transform:translate(-20px,20px) scale(0.9);}}

  .container{ max-width:1400px;margin:0 auto;padding:2rem 1rem;position:relative; z-index:1; }

  header{ background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.2); border-radius:20px; padding:2rem; margin-bottom:1.5rem; box-shadow:0 8px 32px rgba(0,0,0,0.1); text-align:center;}
  header h1{ color:white;font-size:2rem;font-weight:700; text-shadow:0 2px 10px rgba(0,0,0,0.2); display:flex; justify-content:center; align-items:center; gap:0.75rem; }

  .stats-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:1rem; margin-bottom:1.5rem;}
  .stat-card{ background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.3); border-radius:16px; padding:1.75rem 1.5rem; text-align:center; box-shadow:0 8px 32px rgba(0,0,0,0.1); transition: all 0.3s ease;}
  .stat-card:hover{ transform:translateY(-5px); background: rgba(255,255,255,0.2); }
  .stat-icon{ font-size:2rem;margin-bottom:0.5rem; }
  .stat-card h2{ font-size:2rem;color:white;margin-bottom:0.25rem; }
  .stat-card p{ color: rgba(255,255,255,0.95); font-weight:600; font-size:0.9rem; text-transform:uppercase; letter-spacing:1px;}

  .controls{ display:flex; gap:1rem; margin-bottom:1.5rem; flex-wrap:wrap;}
  button{ flex:1; min-width:140px; background: rgba(255,255,255,0.2); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.3); color:white; padding:0.8rem 1.2rem; border-radius:12px; cursor:pointer; font-weight:600; transition:0.3s ease;}
  button:hover{ background: rgba(255,255,255,0.3); transform:translateY(-2px);}
  button.danger{ background: rgba(239,68,68,0.3); border:1px solid rgba(239,68,68,0.5);}
  button.danger:hover{ background: rgba(239,68,68,0.4);}

  .table-container{ background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.2); border-radius:20px; padding:1.5rem; box-shadow:0 8px 32px rgba(0,0,0,0.1); overflow:hidden;}
  .table-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; flex-wrap:wrap; gap:0.5rem;}
  .table-header h3{ color:white; font-size:1.5rem; font-weight:700; }
  .visitor-count{ background: rgba(255,255,255,0.2); padding:0.4rem 0.8rem; border-radius:20px; color:white; font-weight:600; font-size:0.9rem;}

  .table-wrapper{ overflow-x:auto; -webkit-overflow-scrolling:touch; border-radius:12px;}
  table{ width:100%; border-collapse:collapse; font-size:0.9rem; }
  thead{ background: rgba(255,255,255,0.15); }
  th{ padding:0.75rem 1rem; text-align:left; font-weight:700; color:white; text-transform:uppercase; font-size:0.75rem; border-bottom:2px solid rgba(255,255,255,0.2);}
  td{ padding:0.75rem 1rem; color:white; border-bottom:1px solid rgba(255,255,255,0.1);}
  tbody tr{ background: rgba(255,255,255,0.05); transition:0.3s ease;}
  tbody tr:hover{ background: rgba(255,255,255,0.15);}
  .badge{ display:inline-block; padding:0.3rem 0.6rem; background: rgba(255,255,255,0.25); border-radius:6px; font-size:0.75rem; font-weight:600; }
  .time-badge{ display:inline-block; padding:0.25rem 0.5rem; background: rgba(102,126,234,0.3); border-radius:6px; font-size:0.75rem;}
  .user-agent{ max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; opacity:0.9; }

  @media(max-width:768px){
    .stats-grid{ grid-template-columns:repeat(2,1fr);}
    button{ width:100%;}
    th,td{ padding:0.5rem;}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üìä Visitor Analytics Dashboard</h1>
  </header>

  <div class="stats-grid">
    <div class="stat-card"><span class="stat-icon">üë•</span><h2 id="totalVisitors">0</h2><p>Total Visitors</p></div>
    <div class="stat-card"><span class="stat-icon">üåç</span><h2 id="totalCountries">0</h2><p>Countries</p></div>
    <div class="stat-card"><span class="stat-icon">üìç</span><h2 id="totalPaths">0</h2><p>Visited Paths</p></div>
    <div class="stat-card"><span class="stat-icon">üîë</span><h2 id="loginSuccess">0</h2><p>Successful Logins</p></div>
  </div>

  <div class="controls">
    <button onclick="fetchVisitors()">üîÑ Refresh Data</button>
    <button class="danger" onclick="deleteAll()">üóëÔ∏è Delete All Visitors</button>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h3>üìã Visitor Details</h3>
      <span class="visitor-count" id="visitorCount">0 visitors</span>
    </div>
    <div class="table-wrapper">
      <table id="visitorsTable">
        <thead>
          <tr>
            <th>#</th><th>IP</th><th>Country</th><th>City</th><th>User Agent</th><th>Path</th><th>Time</th><th>Login</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
async function fetchVisitors() {
  try {
    const res = await fetch("/visitors");
    const data = await res.json();
    const visitors = data.data || [];

    document.getElementById("totalVisitors").textContent = visitors.length;

    const uniqueCountries = [...new Set(visitors.map(v=>v.country||'Unknown'))];
    document.getElementById("totalCountries").textContent = uniqueCountries.length;

    const uniquePaths = [...new Set(visitors.map(v=>v.path))];
    document.getElementById("totalPaths").textContent = uniquePaths.length;

  const loginCount = visitors.filter(v => v.loginSuccess).length;

    document.getElementById("loginSuccess").textContent = loginCount;

    document.getElementById("visitorCount").textContent = `${visitors.length} visitor${visitors.length!==1?'s':''}`;

    const tbody = document.querySelector("#visitorsTable tbody");
    if(!visitors.length){
      tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;color:white;padding:2rem;">No visitors yet</td></tr>`;
    } else {
      tbody.innerHTML = visitors.map((v,i)=>`
        <tr>
          <td>${i+1}</td>
          <td><span class="badge">${v.ip||'-'}</span></td>
          <td>${v.country||'-'}</td>
          <td>${v.city||'-'}</td>
          <td class="user-agent" title="${v.userAgent||''}">${v.userAgent||'-'}</td>
          <td>${v.path||'-'}</td>
          <td><span class="time-badge">${new Date(v.time).toLocaleString()}</span></td>
          <td>${v.loginSuccess?'‚úÖ':'‚ùå'}</td>
        </tr>
      `).join('');
    }

  } catch(err) {
    console.error(err);
  }
}

async function deleteAll() {
  if(!confirm("Are you sure?")) return;
  try {
    await fetch("/visitors",{method:"DELETE"});
    fetchVisitors();
  } catch(err){ console.error(err); }
}

fetchVisitors();
setInterval(fetchVisitors,10000);
</script>
</body>
</html>
